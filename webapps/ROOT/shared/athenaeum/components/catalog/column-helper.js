"use strict";
exports.columnHelper = {
    setColumnWidthsBasedOnData: function (columnDefs, dataObjects) {
        var MIN_COLUMN_WIDTH = 4;
        var EXTRA_WIDTH_FOR_SELECT_COLUMNS = 2;
        var firstRow = dataObjects[0];
        for (var _i = 0, columnDefs_1 = columnDefs; _i < columnDefs_1.length; _i++) {
            var columnDef = columnDefs_1[_i];
            var titleLength = columnDef.headerName ? columnDef.headerName.length : 1;
            var contentLength = 0;
            if (firstRow) {
                var contentAsString = String(firstRow[columnDef.field]);
                contentLength = contentAsString.length;
            }
            if (columnDef.field === "nameAndId" ||
                columnDef.field === "name") {
                titleLength = 24;
            }
            var maxLength = Math.max(contentLength, titleLength);
            maxLength = Math.max(maxLength, MIN_COLUMN_WIDTH);
            if (columnDef.filter) {
                maxLength += EXTRA_WIDTH_FOR_SELECT_COLUMNS;
            }
            columnDef.width = (maxLength + 1) * 10;
        }
    },
    makeColumnDefsForProperties: function (properties, defaultColumns, additionalColumns) {
        var allProps = properties;
        var visibleCols = defaultColumns;
        var hiddenCols = additionalColumns;
        var columnDefs = [];
        _addMoreColumnDefs(columnDefs, visibleCols, allProps, { hide: false });
        _addMoreColumnDefs(columnDefs, hiddenCols, allProps, { hide: true });
        return columnDefs;
    },
    addCheckboxColumn: function (columnDefs) {
        var CHECKBOX_COLUMN_NAME = "generated-checkbox-column-field";
        var columnDef = {
            field: CHECKBOX_COLUMN_NAME,
            headerName: "",
            checkboxSelection: true,
            suppressMenu: true,
            suppressSorting: true,
            width: 28
        };
        columnDefs.unshift(columnDef);
    }
};
function _linkCellRenderer(text, id) {
    return "<a class=\"link-cell-link\" href=\"#\" data-itemid=\"" + id + "\">\n    " + text + "\n</a>";
}
function _dateCellRenderer(params) {
    if (!params.value) {
        return "";
    }
    var date = new Date(params.value);
    return date.toLocaleString();
}
function _numberCellRenderer(params) {
    var number = params.value;
    return (number || number === 0) ? (number.toLocaleString()) : "";
}
function _columnDefForSchemaProperty(propertyName, schemaProperty) {
    var type = schemaProperty.type;
    var columnDef = {
        field: propertyName,
        headerName: schemaProperty.title,
        description: schemaProperty.description,
        type: schemaProperty.type,
        suppressMenu: true
    };
    if (type === "integer") {
        columnDef.cellRenderer = _numberCellRenderer;
    }
    if (type === "string" && schemaProperty.format === "date-time") {
        columnDef.cellRenderer = _dateCellRenderer;
    }
    if (type === "object" && schemaProperty.cellRenderer) {
        columnDef.cellRenderer = schemaProperty.cellRenderer;
    }
    var idField = schemaProperty.idField;
    if (idField) {
        var renderer_1 = columnDef.cellRenderer;
        if (renderer_1) {
            columnDef.cellRenderer = function (params) {
                if (!params.data) {
                    return "";
                }
                var text = renderer_1.call(this, params);
                return _linkCellRenderer.call(this, text, params.data[idField]);
            };
        }
        else {
            columnDef.cellRenderer = function (params) {
                if (!params.data) {
                    return "";
                }
                return _linkCellRenderer.call(this, params.data[propertyName], params.data[idField]);
            };
        }
    }
    return columnDef;
}
function _assign(to, from) {
    "use strict";
    for (var key in from) {
        if (from.hasOwnProperty(key)) {
            to[key] = from[key];
        }
    }
    return to;
}
function _addMoreColumnDefs(columnDefs, propNames, schemaProps, overrides) {
    "use strict";
    if (propNames) {
        for (var _i = 0, propNames_1 = propNames; _i < propNames_1.length; _i++) {
            var propName = propNames_1[_i];
            var schemaProperty = schemaProps[propName];
            var columnDef = _columnDefForSchemaProperty(propName, schemaProperty);
            var fullColDef = _assign(columnDef, overrides);
            columnDefs.push(fullColDef);
        }
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvY2F0YWxvZy9jb2x1bW4taGVscGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFRVyxvQkFBWSxHQUFHO0lBRXRCLDBCQUEwQixFQUFFLFVBQVMsVUFBNkIsRUFDN0IsV0FBdUI7UUFFeEQsSUFBTSxnQkFBZ0IsR0FBRyxDQUFDLENBQUM7UUFDM0IsSUFBTSw4QkFBOEIsR0FBRyxDQUFDLENBQUM7UUFDekMsSUFBSSxRQUFRLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTlCLEdBQUcsQ0FBQyxDQUFrQixVQUFVLEVBQVYseUJBQVUsRUFBVix3QkFBVSxFQUFWLElBQVUsQ0FBQztZQUE1QixJQUFJLFNBQVMsbUJBQUE7WUFDZCxJQUFJLFdBQVcsR0FDWCxTQUFTLENBQUMsVUFBVSxHQUFHLFNBQVMsQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUMzRCxJQUFJLGFBQWEsR0FBRyxDQUFDLENBQUM7WUFDdEIsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFFWCxJQUFJLGVBQWUsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUN4RCxhQUFhLEdBQUcsZUFBZSxDQUFDLE1BQU0sQ0FBQztZQUMzQyxDQUFDO1lBQ0QsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLEtBQUssS0FBSyxXQUFXO2dCQUMvQixTQUFTLENBQUMsS0FBSyxLQUFLLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQzdCLFdBQVcsR0FBRyxFQUFFLENBQUM7WUFDckIsQ0FBQztZQUNELElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQ3JELFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO1lBQ2xELEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FB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Q0FBQztBQUdELGlCQUFpQixFQUFFLEVBQUUsSUFBSTtJQUNyQixZQUFZLENBQUM7SUFDYixHQUFHLENBQUMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ25CLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzNCLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDeEIsQ0FBQztJQUNMLENBQUM7SUFDRCxNQUFNLENBQUMsRUFBRSxDQUFDO0FBQ2QsQ0FBQztBQUVELDRCQUE0QixVQUE2QixFQUM3QixTQUF3QixFQUN4QixXQUEwQixFQUMxQixTQUFhO0lBQ3JDLFlBQVksQ0FBQztJQUViLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDWixHQUFHLENBQUMsQ0FBaUIsVUFBUyxFQUFULHVCQUFTLEVBQVQsdUJBQVMsRUFBVCxJQUFTLENBQUM7WUFBMUIsSUFBSSxRQUFRLGtCQUFBO1lBQ2IsSUFBSSxjQUFjLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBUzNDLElBQUksU0FBUyxHQUFHLDJCQUEyQixDQUFDLFFBQVEsRUFBRSxjQUFjLENBQUMsQ0FBQztZQUl0RSxJQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBUy9DLFVBQVUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7U0FDL0I7SUFDTCxDQUFDO0FBQ0wsQ0FBQyIsImZpbGUiOiJjb21wb25lbnRzL2NhdGFsb2cvY29sdW1uLWhlbHBlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGNvcHlyaWdodCBDb3B5cmlnaHQgKGMpIDIwMTUsIFBhY2lmaWMgQmlvc2NpZW5jZXMgb2YgQ2FsaWZvcm5pYSwgSW5jLlxuICogQGF1dGhvciA8YSBocmVmPVwibWFpbHRvOmJza2lubmVyQHBhY2lmaWNiaW9zY2llbmNlcy5jb21cIj5CcmlhbiBTa2lubmVyPC9hPlxuICovXG5cbmltcG9ydCB7SVNjaGVtYVByb3BlcnR5fSBmcm9tIFwiLi9pLXNjaGVtYS1wcm9wZXJ0eVwiO1xuaW1wb3J0IHtJQ29sdW1uRGVmfSBmcm9tIFwiLi9pLWNvbHVtbi1kZWZcIjtcblxuZXhwb3J0IGxldCBjb2x1bW5IZWxwZXIgPSB7XG5cbiAgICBzZXRDb2x1bW5XaWR0aHNCYXNlZE9uRGF0YTogZnVuY3Rpb24oY29sdW1uRGVmczogQXJyYXk8SUNvbHVtbkRlZj4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFPYmplY3RzOiBBcnJheTxhbnk+KSB7XG4gICAgICAgIC8vIGZpcnN0Um93IGlzIHVuZGVmaW5lZCBpZiBkYXRhT2JqZWN0cy5sZW5ndGggPT0gMFxuICAgICAgICBjb25zdCBNSU5fQ09MVU1OX1dJRFRIID0gNDtcbiAgICAgICAgY29uc3QgRVhUUkFfV0lEVEhfRk9SX1NFTEVDVF9DT0xVTU5TID0gMjtcbiAgICAgICAgbGV0IGZpcnN0Um93ID0gZGF0YU9iamVjdHNbMF07XG5cbiAgICAgICAgZm9yIChsZXQgY29sdW1uRGVmIG9mIGNvbHVtbkRlZnMpIHtcbiAgICAgICAgICAgIGxldCB0aXRsZUxlbmd0aCA9XG4gICAgICAgICAgICAgICAgY29sdW1uRGVmLmhlYWRlck5hbWUgPyBjb2x1bW5EZWYuaGVhZGVyTmFtZS5sZW5ndGggOiAxO1xuICAgICAgICAgICAgbGV0IGNvbnRlbnRMZW5ndGggPSAwO1xuICAgICAgICAgICAgaWYgKGZpcnN0Um93KSB7XG4gICAgICAgICAgICAgICAgLy8gY29udmVydCBudW1iZXJzIHRvIHN0cmluZ3NcbiAgICAgICAgICAgICAgICBsZXQgY29udGVudEFzU3RyaW5nID0gU3RyaW5nKGZpcnN0Um93W2NvbHVtbkRlZi5maWVsZF0pO1xuICAgICAgICAgICAgICAgIGNvbnRlbnRMZW5ndGggPSBjb250ZW50QXNTdHJpbmcubGVuZ3RoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvbHVtbkRlZi5maWVsZCA9PT0gXCJuYW1lQW5kSWRcIiB8fFxuICAgICAgICAgICAgICAgIGNvbHVtbkRlZi5maWVsZCA9PT0gXCJuYW1lXCIpIHtcbiAgICAgICAgICAgICAgICB0aXRsZUxlbmd0aCA9IDI0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IG1heExlbmd0aCA9IE1hdGgubWF4KGNvbnRlbnRMZW5ndGgsIHRpdGxlTGVuZ3RoKTtcbiAgICAgICAgICAgIG1heExlbmd0aCA9IE1hdGgubWF4KG1heExlbmd0aCwgTUlOX0NPTFVNTl9XSURUSCk7XG4gICAgICAgICAgICBpZiAoY29sdW1uRGVmLmZpbHRlciAvLyAmJlxuICAgICAgICAgICAgLy8gY29sdW1uRGVmLmZpbHRlci50eXBlID09PSB1aUdyaWRDb25zdGFudHMuZmlsdGVyLlNFTEVDVFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgbWF4TGVuZ3RoICs9IEVYVFJBX1dJRFRIX0ZPUl9TRUxFQ1RfQ09MVU1OUztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29sdW1uRGVmLndpZHRoID0gKG1heExlbmd0aCArIDEpICogMTA7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgbWFrZUNvbHVtbkRlZnNGb3JQcm9wZXJ0aWVzOiBmdW5jdGlvbihwcm9wZXJ0aWVzOiBBcnJheTxJU2NoZW1hUHJvcGVydHk+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdENvbHVtbnM/OiBBcnJheTxzdHJpbmc+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkaXRpb25hbENvbHVtbnM/OiBBcnJheTxzdHJpbmc+KTpcbiAgICAgICAgQXJyYXk8SUNvbHVtbkRlZj4ge1xuICAgICAgICBsZXQgYWxsUHJvcHMgPSBwcm9wZXJ0aWVzO1xuICAgICAgICBsZXQgdmlzaWJsZUNvbHMgPSBkZWZhdWx0Q29sdW1ucztcbiAgICAgICAgbGV0IGhpZGRlbkNvbHMgPSBhZGRpdGlvbmFsQ29sdW1ucztcbiAgICAgICAgbGV0IGNvbHVtbkRlZnMgPSBbXTtcbiAgICAgICAgX2FkZE1vcmVDb2x1bW5EZWZzKGNvbHVtbkRlZnMsIHZpc2libGVDb2xzLCBhbGxQcm9wcywge2hpZGU6IGZhbHNlfSk7XG4gICAgICAgIF9hZGRNb3JlQ29sdW1uRGVmcyhjb2x1bW5EZWZzLCBoaWRkZW5Db2xzLCBhbGxQcm9wcywge2hpZGU6IHRydWV9KTtcbiAgICAgICAgcmV0dXJuIGNvbHVtbkRlZnM7XG4gICAgfSxcblxuICAgIGFkZENoZWNrYm94Q29sdW1uOiBmdW5jdGlvbihjb2x1bW5EZWZzOiBBcnJheTxJQ29sdW1uRGVmPikge1xuICAgICAgICAvLyBUbyBzYXZlIGFuZCByZXN0b3JlIHRoZSBzdGF0ZSBvZiB0aGUgY2hlY2tib3ggY29sdW1uLCB0aGUgZmllbGQgbmFtZVxuICAgICAgICAvLyBuZWVkcyB0byBiZSBjb25zaXN0ZW50IG92ZXIgdGltZS4gIFBpY2tpbmcgc29tZXRoaW5nIGhlcmUgcmlza3NcbiAgICAgICAgLy8gYSBuYW1lIGNvbGxpc2lvbiwgYnV0IHNpbmNlIHdlIGNvbnRyb2wgdGhlIHNldCBvZiB0aGluZ3MgdGhhdCBtYXlcbiAgICAgICAgLy8gY29sbGlkZSwgd2UgY2FuIGZpeCBpdCBpZiBhIGNvbGxpc2lvbiBoYXBwZW5zLlxuICAgICAgICBjb25zdCBDSEVDS0JPWF9DT0xVTU5fTkFNRSA9IFwiZ2VuZXJhdGVkLWNoZWNrYm94LWNvbHVtbi1maWVsZFwiO1xuICAgICAgICBsZXQgY29sdW1uRGVmOiBJQ29sdW1uRGVmID0ge1xuICAgICAgICAgICAgZmllbGQ6IENIRUNLQk9YX0NPTFVNTl9OQU1FLFxuICAgICAgICAgICAgaGVhZGVyTmFtZTogXCJcIixcbiAgICAgICAgICAgIC8vIHR5cGU6IHNjaGVtYVByb3BlcnR5LnR5cGUsXG4gICAgICAgICAgICBjaGVja2JveFNlbGVjdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgIHN1cHByZXNzTWVudTogdHJ1ZSxcbiAgICAgICAgICAgIHN1cHByZXNzU29ydGluZzogdHJ1ZSxcbiAgICAgICAgICAgIHdpZHRoOiAyOFxuICAgICAgICB9O1xuICAgICAgICBjb2x1bW5EZWZzLnVuc2hpZnQoY29sdW1uRGVmKTtcbiAgICB9XG59O1xuXG5mdW5jdGlvbiBfbGlua0NlbGxSZW5kZXJlcih0ZXh0OiBzdHJpbmcsIGlkOiBzdHJpbmcpIHtcbiAgICAvLyBUT0RPKGJmb3JiZXMpKDIwMTUtMDktMjMpIEZpZ3VyZSBvdXQgaG93IHRvIHB1dCB0aGUgY29ycmVjdCByb3V0ZXJcbiAgICAvLyBVUkwgaW50byB0aGUgYGhyZWZgIGF0dHJpYnV0ZSBpbiBhIHJldXNhYmxlIHdheTsgZm9yIG5vdyB0aGlzIHVzZXNcbiAgICAvLyBldmVudCBkZWxlZ2F0aW9uLCBncmFicyBgZGF0YS1pdGVtaWRgIGZyb20gdGhlIG5vZGUsIGFuZCBlbWl0cyBhblxuICAgIC8vIGV2ZW50LiBUaGlzIHNob3VsZCBwcm9iYWJseSBlaXRoZXIgdXNlIFJvdXRlckxpbmsgb3IgYXBwZW5kIHRoZSBJRFxuICAgIC8vIHRvIGEgcm91dGVyIFVSTCBwcmVmaXggcGFzc2VkIGludG8gdGhlIGNhdGFsb2cgaW5zdGFuY2VcbiAgICByZXR1cm4gYDxhIGNsYXNzPVwibGluay1jZWxsLWxpbmtcIiBocmVmPVwiI1wiIGRhdGEtaXRlbWlkPVwiJHtpZH1cIj5cbiAgICAke3RleHR9XG48L2E+YDtcbn1cblxuZnVuY3Rpb24gX2RhdGVDZWxsUmVuZGVyZXIocGFyYW1zKSB7XG4gICAgaWYgKCFwYXJhbXMudmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuICAgIGxldCBkYXRlID0gbmV3IERhdGUocGFyYW1zLnZhbHVlKTtcbiAgICByZXR1cm4gZGF0ZS50b0xvY2FsZVN0cmluZygpO1xufVxuXG5mdW5jdGlvbiBfbnVtYmVyQ2VsbFJlbmRlcmVyKHBhcmFtcykge1xuICAgIGxldCBudW1iZXIgPSBwYXJhbXMudmFsdWU7XG4gICAgcmV0dXJuIChudW1iZXIgfHwgbnVtYmVyID09PSAwKSA/IChudW1iZXIudG9Mb2NhbGVTdHJpbmcoKSkgOiBcIlwiO1xufVxuXG5mdW5jdGlvbiBfY29sdW1uRGVmRm9yU2NoZW1hUHJvcGVydHkocHJvcGVydHlOYW1lOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hUHJvcGVydHk6IElTY2hlbWFQcm9wZXJ0eSkge1xuICAgIGxldCB0eXBlID0gc2NoZW1hUHJvcGVydHkudHlwZTtcbiAgICBsZXQgY29sdW1uRGVmOiBJQ29sdW1uRGVmID0ge1xuICAgICAgICBmaWVsZDogcHJvcGVydHlOYW1lLFxuICAgICAgICBoZWFkZXJOYW1lOiBzY2hlbWFQcm9wZXJ0eS50aXRsZSxcbiAgICAgICAgZGVzY3JpcHRpb246IHNjaGVtYVByb3BlcnR5LmRlc2NyaXB0aW9uLFxuICAgICAgICB0eXBlOiBzY2hlbWFQcm9wZXJ0eS50eXBlLFxuICAgICAgICBzdXBwcmVzc01lbnU6IHRydWVcbiAgICB9O1xuXG4gICAgaWYgKHR5cGUgPT09IFwiaW50ZWdlclwiKSB7XG4gICAgICAgIGNvbHVtbkRlZi5jZWxsUmVuZGVyZXIgPSBfbnVtYmVyQ2VsbFJlbmRlcmVyO1xuICAgIH1cbiAgICBpZiAodHlwZSA9PT0gXCJzdHJpbmdcIiAmJiBzY2hlbWFQcm9wZXJ0eS5mb3JtYXQgPT09IFwiZGF0ZS10aW1lXCIpIHtcbiAgICAgICAgY29sdW1uRGVmLmNlbGxSZW5kZXJlciA9IF9kYXRlQ2VsbFJlbmRlcmVyO1xuICAgIH1cbiAgICBpZiAodHlwZSA9PT0gXCJvYmplY3RcIiAmJiBzY2hlbWFQcm9wZXJ0eS5jZWxsUmVuZGVyZXIpIHtcbiAgICAgICAgY29sdW1uRGVmLmNlbGxSZW5kZXJlciA9IHNjaGVtYVByb3BlcnR5LmNlbGxSZW5kZXJlcjtcbiAgICB9XG4gICAgY29uc3QgaWRGaWVsZCA9IHNjaGVtYVByb3BlcnR5LmlkRmllbGQ7XG4gICAgaWYgKGlkRmllbGQpIHtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBjb2x1bW5EZWYuY2VsbFJlbmRlcmVyO1xuICAgICAgICBpZiAocmVuZGVyZXIpIHtcbiAgICAgICAgICAgIGNvbHVtbkRlZi5jZWxsUmVuZGVyZXIgPSBmdW5jdGlvbiAocGFyYW1zOiBhbnkpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXBhcmFtcy5kYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSByZW5kZXJlci5jYWxsKHRoaXMsIHBhcmFtcyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9saW5rQ2VsbFJlbmRlcmVyLmNhbGwodGhpcywgdGV4dCwgcGFyYW1zLmRhdGFbaWRGaWVsZF0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbHVtbkRlZi5jZWxsUmVuZGVyZXIgPSBmdW5jdGlvbiAocGFyYW1zOiBhbnkpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXBhcmFtcy5kYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gX2xpbmtDZWxsUmVuZGVyZXIuY2FsbCh0aGlzLCBwYXJhbXMuZGF0YVtwcm9wZXJ0eU5hbWVdLCBwYXJhbXMuZGF0YVtpZEZpZWxkXSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qaWYgKHR5cGUgPT09IFwic3RyaW5nXCIgJiYgaWQpIHtcbiAgICAgICAgY29sdW1uRGVmLmZpZWxkID0gcHJvcGVydHlOYW1lICsgXCJBbmRJZFwiO1xuICAgICAgICBjb2x1bW5EZWYuY2VsbFJlbmRlcmVyID0gX2xpbmtDZWxsUmVuZGVyZXI7XG4gICAgfSovXG5cbiAgICByZXR1cm4gY29sdW1uRGVmO1xufVxuXG4vLyBUT0RPKGJza2lubmVyKTogZGVsZXRlIHRoaXMgb25jZSB3ZSdyZSB1c2luZyBPYmplY3QuYXNzaWduKCkgaW5zdGVhZFxuZnVuY3Rpb24gX2Fzc2lnbih0bywgZnJvbSkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIGZvciAobGV0IGtleSBpbiBmcm9tKSB7XG4gICAgICAgIGlmIChmcm9tLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgIHRvW2tleV0gPSBmcm9tW2tleV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRvO1xufVxuXG5mdW5jdGlvbiBfYWRkTW9yZUNvbHVtbkRlZnMoY29sdW1uRGVmczogQXJyYXk8SUNvbHVtbkRlZj4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcE5hbWVzOiBBcnJheTxzdHJpbmc+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYVByb3BzOiB7aWQ/OiBzdHJpbmd9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJyaWRlczoge30pIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIGlmIChwcm9wTmFtZXMpIHtcbiAgICAgICAgZm9yIChsZXQgcHJvcE5hbWUgb2YgcHJvcE5hbWVzKSB7XG4gICAgICAgICAgICBsZXQgc2NoZW1hUHJvcGVydHkgPSBzY2hlbWFQcm9wc1twcm9wTmFtZV07XG4gICAgICAgICAgICAvLyBsZXQgaWQgPSBudWxsO1xuICAgICAgICAgICAgLy8gVE9ETyhic2tpbm5lcik6IGZpeCB0aGlzIGhhY2shXG4gICAgICAgICAgICAvKmlmIChwcm9wTmFtZSA9PT0gXCJuYW1lXCIgJiZcbiAgICAgICAgICAgICAgICBzY2hlbWFQcm9wcy5pZCAmJlxuICAgICAgICAgICAgICAgIHByb3BOYW1lcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgaWQgPSBzY2hlbWFQcm9wcy5pZDtcbiAgICAgICAgICAgIH0qL1xuXG4gICAgICAgICAgICBsZXQgY29sdW1uRGVmID0gX2NvbHVtbkRlZkZvclNjaGVtYVByb3BlcnR5KHByb3BOYW1lLCBzY2hlbWFQcm9wZXJ0eSk7XG5cbiAgICAgICAgICAgIC8vIFRPRE8oYnNraW5uZXIpOlxuICAgICAgICAgICAgLy8gbGV0IGZ1bGxDb2xEZWYgPSBPYmplY3QuYXNzaWduKHt9LCBjb2x1bW5EZWYsIG92ZXJyaWRlcyk7XG4gICAgICAgICAgICBsZXQgZnVsbENvbERlZiA9IF9hc3NpZ24oY29sdW1uRGVmLCBvdmVycmlkZXMpO1xuXG4gICAgICAgICAgICAvLyBpZiAocHJvcE5hbWUgPT09IFwicnVuTmFtZVwiKSB7XG4gICAgICAgICAgICAvLyAgICBmdWxsQ29sRGVmLmdyb3VwaW5nID0ge2dyb3VwUHJpb3JpdHk6IDB9O1xuICAgICAgICAgICAgLy8gICAgZnVsbENvbERlZi5zb3J0ID0ge1xuICAgICAgICAgICAgLy8gICAgICAgIHByaW9yaXR5OiAwLFxuICAgICAgICAgICAgLy8gICAgICAgIGRpcmVjdGlvbjogXCJkZXNjXCJcbiAgICAgICAgICAgIC8vICAgIH07XG4gICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICBjb2x1bW5EZWZzLnB1c2goZnVsbENvbERlZik7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=